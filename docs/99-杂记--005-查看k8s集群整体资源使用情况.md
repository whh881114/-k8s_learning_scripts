# 99-杂记--005-查看k8s集群整体资源使用情况.md

## 说明
- 虽然prometheus-operator中有自带cluster级别的计算资源图形，但是并不满足我的需求，所以考虑自己整理出一个界面来。

## 需求
- 只创建一个页面，此页面中包含ROW，用ROW来区分不同的类型的资源使用情况。

- 显示一台宿主机的资源使用情况，需要使用变量来过滤。在prometheus管理界面上，查询集群主机清单使用查询语句为`kubelet_node_name{service="kubelet"}`
  - 在创建dashboard时，定义两个变量，`QUERY_TYPE`和`QUERY_TYPE_VALUE`。
  - `QUERY_TYPE`选用自定义类型，其值为`node,instance`，这两个值对应的就是`kubelet_node_name{service="kubelet"}`查询出来的标签。
  - `QUERY_TYPE_VALUE`先用查询类型，其值则为`kubelet_node_name{service="kubelet"}`，正则匹配则为`/$QUERY_TYPE=\"(.*?)(:10250)?\"/`，这样可匹配到主机名和IP地址了。

