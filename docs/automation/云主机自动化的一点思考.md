# 云主机自动化的一点思考

做自动化的前提就是标准化，这里先对标准化方面做一下介绍。目前市面上绝大部分公司都使用云厂商的资源构建自己的业务平台，所以下以的标准是假定
使用者使云主机的前提下所做的一些选型。


## 标准化
以下两点就满足了执行自动化的前提。
- 操作系统的选择：CentOS-7操作系统于2024-06-30结束生命周期，在此之后选择RockyLinux，版本为9，官网地址：https://rockylinux.org。
- 自动化工具：ansible，目前自动化管理工具已趋于成熟，所以依然选择ansible。


## 现状
- 第一，目前主流技术已转向容器，所以云主机上可做的文章会越来越少，所以在做标准化方面主要是围绕安全基线方面和系统漏洞修复。  
- 第二，能选择云厂商SaaS服务就决不自建，如MySQL，Redis-Cluster，RocketMQ之类的服务，如自建MySQL可以会涉及数据泄密安全问题。
- 第三，尽量使用云厂商的LB替代自建的nginx/haproxy，这样不用担心nginx/haproxy漏洞修复，此外，LB更新ssl证书更加方便。
- 第四，云主机基础监控，使用云厂商即可，不再使用自建zabbix，如果确实有业务监控需求，优先考虑Prometheus方案。


## 趋势化
根据现状，所以初始化的动作可以尽量快。RockyLinux9镜像中配置ansible的ssh key，如无其他必要配置则无需增加。主机初始化仅执行一次，在初始
化过程中有一个需要讨论的点————主机名。

## 讨论点
- 主机名是否有必要全局唯一？
  - 答：主机名是否需要全局唯一，这个得看需求，例如分布式存储ceph就要求主机名唯一，涉及到监控也需要主机名唯一，如zabbix-agent主动上报。

- 如果不要求全局唯一，会有什么影响？
  - 答：如果不要求全局唯一，那么各主机之前没有任何联系，目前主机可以不用安装监控代理，直接使用云厂商的看起来是没有问题的，但是不能保证后续
        会有自定义监控需求，或者有一些大数据的应用，这些是需要主机名唯一的。

- 如果要求全局唯一，那么怎么保证全局唯一？
  - 答：从上述分析来看，主机名全局唯一是有必要执行，但是关键的问题在于，如何保证唯一呢。从当前的情况看，主机分为存量主机和新增主机，
        新增主机可以管控，存量主机目前是安装了consul-agent可以上报状态，这些是唯一的，但是没有安装的就保证不了，所以解决方法也简单，
        将存量主机安装consul-agent即可，如果遇到有重复主机名，做出修改即可。所以从分析的情况来看，执行起来并没有什么困难。

- 主机名要求全局唯一，那么如何维护主机名全局唯一呢？
  - 答：先是做到了主机名可以设置为全局唯一，那么如何持续维护呢？如某大数据主机释放了，原来主机名是TEST-DATA-003，后来又加回来了一台主机
        那么，新主机名如何知道主机名是否能设置为TEST-DATA-003，是靠运维人员去和大数据运维人员确认，还是说能程序能自行判断？