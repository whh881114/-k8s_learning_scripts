# 检查hostname是否全局唯一

## 方案一
逻辑判断：当客户端请求初始化时，首先判断主机名（test-bigdata-001）是否已存在consul中，并且主机名所对应的consul-agent处于存活状态。
  - 如果存在，那么就报错退出初始化程序，同时，服务端在redis中删除test-bigdata-001锁，防止之前初始化后，其锁没有释放。
  - 如果不存在，那么需要将主机名test-bigdata-001锁定起来。
      - 当其他客户端使用相同主机名请求时，则提示此主机名处于锁定状态，那么就报错退出初始化程序。
      - 当没有其他客户端抢占主机名时，那么就等主机初始化完成后，释放主机名test-bigdata-001锁。

方案缺陷：因为consul-agent会因为网络故障会出现failed或者关机，两分钟后就不在members清单中。当新主机使用了test-bigdata-001主机名
    初始化后，原来主机开机后consul-agent则无法启动。

## 方案二
逻辑判断：
    ** 这个方法不好，因为consul-agent会因为网络故障会出现failed或者关机，两分钟后就不在members清单中。而新主机使用了
    ** 已存在的主机名，那之前的主机开机后就无法启动consul-agent。
    ** 所以，此时，可以向consul中写入kv作为锁，因consul-ui无保护机制，可以将监控地址修改成127.0.0.1，使用httpd配置反向代理，
    ** 并且配置身份验证。除此之外，consul-agent端禁用掉ui。
    ** 以上对锁的逻辑需要做修改。
    **   - kv锁存在，那就一直让锁存在，直到主机请求注销流程，以流程的方式来处理死锁。但是主机重复初始化时就会失败，提示主机名一直
    **     处于占用状态。那么，这个时间可以从v值（ip）判断是否相同，如果相同则可以再次初始化，如果不同则需要人工确认处理。
    **        - 这个方法不行，因为原主机修改了ip，那么这个锁就成了死锁后，所以必须要解锁，解锁的方式是机器初始化完成后，
    **          要检查consul-agent存活状态，确认上报了，才能说明主机名是可用的，然后可以释放锁。
    **        - 
    **   - kv锁不存在，那么先设置锁，直到流程流程执行完成。