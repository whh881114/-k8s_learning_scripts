# 01-k8s.sh.freedom.org-000-0-部署集群v1.22.2.md


## 正文
- 安装后续的组件。
  ```shell
  ansible-playbook master01.k8s.sh.freedom.org-addons.yml
  ```

- 安装rancher管理平台。
  ```shell
    proxy_host="rancher.k8s.sh.freedom.org"

    helm repo add jetstack https://charts.jetstack.io
    
    kubectl create namespace cert-manager
    
    kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.5.1/cert-manager.crds.yaml
     
    helm upgrade --install cert-manager jetstack/cert-manager \
      --namespace cert-manager --version v1.5.1 \
      --set http_proxy=http://${proxy_host} \
      --set https_proxy=http://${proxy_host} \
      --set no_proxy=127.0.0.0/8\\,10.0.0.0/8\\,cattle-system.svc\\,172.16.0.0/12\\,192.168.0.0/16\\,.svc\\,.cluster.local
    
    helm repo add rancher-latest https://releases.rancher.com/server-charts/latest
   
    kubectl create namespace cattle-system
   
    helm upgrade --install rancher rancher-latest/rancher \
      --namespace cattle-system \
      --set hostname=${proxy_host} \
      --set proxy=http://${proxy_host} \
      --set no_proxy=127.0.0.0/8\\,10.0.0.0/8\\,cattle-system.svc\\,172.16.0.0/12\\,192.168.0.0/16\\,.svc\\,.cluster.local
  ```
    
- rancher管理平台日志。
  ```shell
    W1002 22:46:29.794751   22846 warnings.go:70] cert-manager.io/v1beta1 Issuer is deprecated in v1.4+, unavailable in v1.6+; use cert-manager.io/v1 Issuer
    Release "rancher" has been upgraded. Happy Helming!
    NAME: rancher
    LAST DEPLOYED: Sun Oct  2 22:46:27 2022
    NAMESPACE: cattle-system
    STATUS: deployed
    REVISION: 3
    TEST SUITE: None
    NOTES:
    Rancher Server has been installed.
    
    NOTE: Rancher may take several minutes to fully initialize. Please standby while Certificates are being issued, Containers are started and the Ingress rule comes up.
    
    Check out our docs at https://rancher.com/docs/
    
    If you provided your own bootstrap password during installation, browse to https://rancher.k8s.sh.freedom.org to get started.
    
    If this is the first time you installed Rancher, get started by running this command and clicking the URL it generates:
    
    echo https://rancher.k8s.sh.freedom.org/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template='{{.data.bootstrapPassword|base64decode}}')

    
    To get just the bootstrap password on its own, run:
    
    kubectl get secret --namespace cattle-system bootstrap-secret -o go-template='{{.data.bootstrapPassword|base64decode}}{{ "\n" }}'

    
    
    Happy Containering!
  ```